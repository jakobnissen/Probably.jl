<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>HyperLogLog · Probably.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Probably.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>HyperLogLog</a><ul class="internal"><li><a class="tocitem" href="#What-it-is"><span>What it is</span></a></li><li><a class="tocitem" href="#Usage-example"><span>Usage example</span></a></li><li><a class="tocitem" href="#Interface"><span>Interface</span></a></li></ul></li><li><a class="tocitem" href="../countmin/">Count-min sketch</a></li><li><a class="tocitem" href="../cuckoo/">Cuckoo filter</a></li><li><a class="tocitem" href="../bloom/">Bloom filter</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>HyperLogLog</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>HyperLogLog</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jakobnissen/Probably.jl/blob/master/docs/src/hyperloglog.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="HyperLogLog"><a class="docs-heading-anchor" href="#HyperLogLog">HyperLogLog</a><a id="HyperLogLog-1"></a><a class="docs-heading-anchor-permalink" href="#HyperLogLog" title="Permalink"></a></h1><p>_References: Original algorithm: Flajolet, Fusy, Gandouet &amp; Meunier: &quot;Hyperloglog: The analysis of a near-optimal cardinality estimation algorithm&quot;.</p><p>With some of the modifications from: Heule, Nunkesser &amp; Hall: &quot;HyperLogLog in practice: Algorithmic engineering of a state of the art cardinality estimation algorithm&quot;._</p><hr/><h2 id="What-it-is"><a class="docs-heading-anchor" href="#What-it-is">What it is</a><a id="What-it-is-1"></a><a class="docs-heading-anchor-permalink" href="#What-it-is" title="Permalink"></a></h2><p>An HyperLogLog is a very memory-efficient datastructure that keeps track of approximately how many distinct, hashable elements it&#39;s seen. A default HLL uses 16 KiB of memory and can return reliable estimates of up to some very large cardinality (on the order of 2^59 distinct elements).</p><p>This estimate of cardinality has a median error of 0.5 %, and a 99 % chance of having an error less than 2.5 %, when the cardinality estimate is &gt;1024. To accurately keep track of datasets smaller than 1024, use another datastructure like a <code>Set</code>.</p><p>This implementation is not optimally memory-efficient, but it is fast. More advanced tricks can be found in the Heule et al. paper linked above, which increases accuracy and lowers memory usage for small N.</p><p>The HLLs are not guaranteed to be threadsafe. To parallelize this implementation of HLL, each process/thread must operate on independent HLLs. These can then be efficiently merged using <code>union</code> or <code>union!</code> (or <code>∪</code>). This is much faster than using atomic operations.</p><h2 id="Usage-example"><a class="docs-heading-anchor" href="#Usage-example">Usage example</a><a id="Usage-example-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-example" title="Permalink"></a></h2><p>In this example, let&#39;s say I&#39;m given 133 million <a href="https://en.wikipedia.org/wiki/FASTQ_format">fastq-sequences</a> from a large sequencing project of Neanderthal bones. 133 million reads sounds like a lot, so, I&#39;m worried that the lab folk went a little overboard on the PCR and the same reads are present in many copies. Hence, I want to know how many unique reads there are. I don&#39;t care that the HyperLogLog doesn&#39;t fit in the cache, so I&#39;ll crank the <code>P</code> parameter up to 18 and spend the 256 KiB memory to maximize accuracy:</p><pre><code class="language-none">hll = HyperLogLog{18}()
reader = FASTQ.Reader(open(&quot;huge_file.fastq&quot;, &quot;r&quot;))
for record in reader
    seq = sequence(record) # we want a hashable DNA sequence    
    push!(hll, seq)
end
println(&quot;Number of distinct FASTQ-sequences: &quot;, length(hll))</code></pre><h2 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h2><h3 id="Construction"><a class="docs-heading-anchor" href="#Construction">Construction</a><a id="Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Construction" title="Permalink"></a></h3><p>The accuracy of a HLL depends on its <code>P</code> parameter. You can construct a HLL with its <code>P</code> parameter directly:</p><pre><code class="language-none">julia&gt; hll = HyperLogLog{14}()
HyperLogLog{14}()</code></pre><p>A P-value of 14 is considered default, so if you don&#39;t pass the parameter, 14 is assumed as default:</p><pre><code class="language-none">julia&gt; HyperLogLog{14}() == HyperLogLog()
true</code></pre><h3 id="Central-functions"><a class="docs-heading-anchor" href="#Central-functions">Central functions</a><a id="Central-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Central-functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="Base.push!-Tuple{HyperLogLog, Any}" href="#Base.push!-Tuple{HyperLogLog, Any}"><code>Base.push!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">push!(hll::HyperLogLog, items...)</code></pre><p>Add each item to the HLL. This has no effect if the HLL has seen the items before.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; a = HyperLogLog{14}(); push!(a, 1,2,3,4,5,6,7,8,9); length(a)
9</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/033a13b32697f58aad8131e81366e58185b7fe48/src/hyperloglog/hyperloglog.jl#L142-L152">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.length-Tuple{HyperLogLog}" href="#Base.length-Tuple{HyperLogLog}"><code>Base.length</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">length(hll::HyperLogLog{Precision})</code></pre><p>Estimate the number of distinct elements the HLL has seen. The error depends on the Precision parameter. This has low absolute rror when the estimate is small, and low relative error when the estimate is high.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; a = HyperLogLog{14}(); push!(a, 1,2,3,4,5,6,7,8); length(a)
9</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/033a13b32697f58aad8131e81366e58185b7fe48/src/hyperloglog/hyperloglog.jl#L202-L214">source</a></section></article><h3 id="Misc-functions"><a class="docs-heading-anchor" href="#Misc-functions">Misc functions</a><a id="Misc-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Misc-functions" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>HyperLogLog supports the following operations, which have no HyperLogLog-specific docstring because they behave as stated in the documentation in Base:</p></div></div><pre><code class="language-none">Base.copy!
Base.copy
Base.sizeof # This one includes the underlying array</code></pre><article class="docstring"><header><a class="docstring-binding" id="Base.isempty-Tuple{HyperLogLog}" href="#Base.isempty-Tuple{HyperLogLog}"><code>Base.isempty</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">isempty(x::HyperLogLog)</code></pre><p>Return <code>true</code> if the HLL has not seen any elements, <code>false</code> otherwise. This is guaranteed to be correct, and so can be <code>true</code> even when length(x) &gt; 0.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; a = HyperLogLog{14}(); (length(a), isempty(a))
(1, true)

&gt;julia push!(a, 1); (length(a), isempty(a))
(1, false)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/033a13b32697f58aad8131e81366e58185b7fe48/src/hyperloglog/hyperloglog.jl#L115-L129">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.empty!-Tuple{HyperLogLog}" href="#Base.empty!-Tuple{HyperLogLog}"><code>Base.empty!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">empty!(x::HyperLogLog)</code></pre><p>Reset the HLL to its beginning state (i.e. &quot;deleting&quot; all elements from the HLL), returning it.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; empty!(a); length(a) # should return approximately 0
1</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/033a13b32697f58aad8131e81366e58185b7fe48/src/hyperloglog/hyperloglog.jl#L101-L112">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.union!-Union{Tuple{P}, Tuple{HyperLogLog{P}, HyperLogLog{P}}} where P" href="#Base.union!-Union{Tuple{P}, Tuple{HyperLogLog{P}, HyperLogLog{P}}} where P"><code>Base.union!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">union!(dest::HyperLogLog{P}, src::HyperLogLog{P})</code></pre><p>Overwrite <code>dest</code> with the same result as <code>union(dest, src)</code>, returning <code>dest</code>.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; # length(c) ≥ length(b) is not guaranteed, but overwhelmingly likely
julia&gt; c = union!(a, b); c === a &amp;&amp; length(c) ≥ length(b)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/033a13b32697f58aad8131e81366e58185b7fe48/src/hyperloglog/hyperloglog.jl#L56-L67">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.union-Union{Tuple{P}, Tuple{HyperLogLog{P}, HyperLogLog{P}}} where P" href="#Base.union-Union{Tuple{P}, Tuple{HyperLogLog{P}, HyperLogLog{P}}} where P"><code>Base.union</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">union(x::HyperLogLog{P}, y::HyperLogLog{P})</code></pre><p>Create a new HLL identical to an HLL which has seen the union of the elements <code>x</code> and <code>y</code> has seen.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; # That c is longer than a or b is not guaranteed, but overwhelmingly likely
julia&gt; c = union(a, b); length(c) ≥ length(a) &amp;&amp; length(c) ≥ length(b)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/033a13b32697f58aad8131e81366e58185b7fe48/src/hyperloglog/hyperloglog.jl#L76-L88">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../countmin/">Count-min sketch »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 26 July 2022 07:06">Tuesday 26 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
