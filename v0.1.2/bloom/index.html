<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Bloom filter · Probably.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Probably.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../hyperloglog/">HyperLogLog</a></li><li><a class="tocitem" href="../countmin/">Count-min sketch</a></li><li><a class="tocitem" href="../cuckoo/">Cuckoo filter</a></li><li class="is-active"><a class="tocitem" href>Bloom filter</a><ul class="internal"><li><a class="tocitem" href="#What-it-is"><span>What it is</span></a></li><li><a class="tocitem" href="#Usage-example"><span>Usage example</span></a></li><li><a class="tocitem" href="#Interface"><span>Interface</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Bloom filter</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Bloom filter</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jakobnissen/Probably.jl/blob/master/docs/src/bloom.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Bloom-filter"><a class="docs-heading-anchor" href="#Bloom-filter">Bloom filter</a><a id="Bloom-filter-1"></a><a class="docs-heading-anchor-permalink" href="#Bloom-filter" title="Permalink"></a></h1><p><em>Reference: Bloom: &quot;Space/time trade-offs in hash coding with allowable errors&quot;</em></p><hr/><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>See also the page: <a href="../cuckoo_v_bloom/#Cuckoo-versus-bloom-filters">Cuckoo versus bloom filters</a></p></div></div><h2 id="What-it-is"><a class="docs-heading-anchor" href="#What-it-is">What it is</a><a id="What-it-is-1"></a><a class="docs-heading-anchor-permalink" href="#What-it-is" title="Permalink"></a></h2><p>A bloom filter is the prototypical probabilistic data structure. Elements can be added to a bloom filter, and afterwards, the filter can be queried about whether or not an element is in the filter. A bloom filter exhibits false positives, but not false negatives. In other words, a bloom filter will sometimes report an object to be present when it in fact is not, but whenever the object is not found in the bloom filter, it is guaranteed to truly not be in the filter. Element cannot be extracted from a bloom filter.</p><p>A bloom filter is parameterized by two parameters, its length, <code>m</code> and the parameter <code>k</code>. Memory usage is <code>m/8</code> bytes plus a few bytes of overhead.</p><p>Bloom filters have infinite capacity, but their false positive rates asymptotically approach 1 as more objects are added. The capacity given for a bloom filter by this package refers to the number of distinct elements at which the expected false positive rate is below a given threshold.</p><h3 id="Querying-(in)"><a class="docs-heading-anchor" href="#Querying-(in)">Querying (<code>in</code>)</a><a id="Querying-(in)-1"></a><a class="docs-heading-anchor-permalink" href="#Querying-(in)" title="Permalink"></a></h3><p>Querying time is constant. A filter with parameters <code>m</code> and <code>k</code> containing <code>N</code> distinct object has an expected false positive rate of <code>(1-exp(-k*N/m))^k</code>.</p><h3 id="Pushing-(push!)"><a class="docs-heading-anchor" href="#Pushing-(push!)">Pushing (<code>push!</code>)</a><a id="Pushing-(push!)-1"></a><a class="docs-heading-anchor-permalink" href="#Pushing-(push!)" title="Permalink"></a></h3><p>Pushing time is constant and does not change the memory usage of the bloom filter. All hashable object can be pushed to the filter.</p><h3 id="Deletion"><a class="docs-heading-anchor" href="#Deletion">Deletion</a><a id="Deletion-1"></a><a class="docs-heading-anchor-permalink" href="#Deletion" title="Permalink"></a></h3><p>Bloom filters do not support deletion.</p><h2 id="Usage-example"><a class="docs-heading-anchor" href="#Usage-example">Usage example</a><a id="Usage-example-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-example" title="Permalink"></a></h2><p>Let&#39;s use the same example as for the Cuckoo filter: Again, I have a stream of <a href="https://en.wikipedia.org/wiki/K-mer">kmers</a> that I want to count. Of course I use BioJulia, so these kmers are represented by a <code>DNAKmer{31}</code> object. I suspect my stream has up to 2 billion different kmers, so keeping a counting Dict would use up all my memory. However, most kmers are measurement errors that only appear once and that I do not need spend memory on keeping count of. So I keep track of which kmers I&#39;ve seen using a Cuckoo filter. If I see a kmer more than once, I add it to the Dict.</p><pre><code class="language-none">params = constrain(BloomFilter, fpr=0.02, capacity=2_000_000_000)
if params.memory &gt; 4e9 # I&#39;m only comfortable using 4 GB of memory for this
    error(&quot;Too little memory :(&quot;)
end
filter = BloomFilter(params.m, params.k)
counts = Dict{Kmer, UInt8}() # Don&#39;t need to count higher than 255

for kmer in each(DNAKmer{31}, fastq_parser)
    if kmer in filter
        # Only add kmers we&#39;ve seen before
        count = min(0xfe, get(counts, kmer, 0x01)) # No integer overflow
        counts[kmer] = count + 0x01
    else
        push!(filter, kmer)
    end
end</code></pre><h2 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h2><h3 id="Construction"><a class="docs-heading-anchor" href="#Construction">Construction</a><a id="Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Construction" title="Permalink"></a></h3><p>Bloom filters can be constructed directly given <code>m</code> and <code>k</code>:</p><p><code>x = BloomFilter(100_000_000, k=10)</code></p><p>And this will work just fine. However, in typical cases, people want to construct bloom filters with a set of constrains like &quot;I have 100 MB memory and I want to hold object with a false positive rate of at most 5%&quot;. For this purpose, use the <code>constrain</code> function.</p><p>This function takes a type and two of three keyword arguments:</p><ul><li><code>fpr</code>: Maximal false positive rate</li><li><code>memory</code>: Maximal memory usage</li><li><code>capacity</code>: Minimum number of distinct elements it can contain</li></ul><p>It returns a <code>NamedTuple</code> with the parameters for an object of the specified type which fits the criteria:</p><pre><code class="language-none">julia&gt; constrain(BloomFilter, fpr=0.05, memory=100_000_000)
(m = 799999808, k = 4, fpr = 0.04999999240568489, memory = 100000000, capacity = 128061884)</code></pre><p>This means the optimal bloom filter consuming less than 100 MB of RAM and having a FPR of less than 0.05 can be constructed by:</p><p><code>x = BloomFilter(799999808, 4)</code></p><h3 id="Central-functions"><a class="docs-heading-anchor" href="#Central-functions">Central functions</a><a id="Central-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Central-functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="Base.in-Tuple{Any, BloomFilter}" href="#Base.in-Tuple{Any, BloomFilter}"><code>Base.in</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">in(item, filter::BloomFilter)</code></pre><p>Determine if item is in bloom filter. This sometimes returns <code>true</code> when the correct answer is <code>false</code>, but never returns <code>false</code> when the correct answer is <code>true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/d9437535b5e2046d01411bbe2767c49c645037f5/src/bloom/filter.jl#L58-L63">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.push!-Tuple{BloomFilter, Vararg{Any}}" href="#Base.push!-Tuple{BloomFilter, Vararg{Any}}"><code>Base.push!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">push!(filter::BloomFilter, items...)</code></pre><p>Add one or more hashable items to the bloom filter.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/d9437535b5e2046d01411bbe2767c49c645037f5/src/bloom/filter.jl#L48-L52">source</a></section></article><h3 id="Misc-functions"><a class="docs-heading-anchor" href="#Misc-functions">Misc functions</a><a id="Misc-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Misc-functions" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Bloom filters supports the following operations, which have no bloom-specific docstring because they behave as stated in the documentation in Base:</p></div></div><pre><code class="language-none">Base.copy!
Base.copy
Base.union!
Base.union
Base.sizeof # This one includes the underlying array</code></pre><article class="docstring"><header><a class="docstring-binding" id="Base.length-Tuple{BloomFilter}" href="#Base.length-Tuple{BloomFilter}"><code>Base.length</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">length(filter::BloomFilter) -&gt; Float64</code></pre><p>Provide an <em>estimate</em> of the number of distinct elements in the filter. This may return <code>Inf</code> if the filter is entirely full.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; a = BloomFilter(10000, 4); for i in 1:5000 push!(a, i) end; length(a)
4962.147247984721</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/d9437535b5e2046d01411bbe2767c49c645037f5/src/bloom/filter.jl#L81-L92">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.isempty-Tuple{BloomFilter}" href="#Base.isempty-Tuple{BloomFilter}"><code>Base.isempty</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">isempty(filter::BloomFilter)</code></pre><p>Determine if bloom filter is empty, i.e. has no elements in it. This is guaranteed to be correct, but does not mean the fitler consumes no RAM.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/d9437535b5e2046d01411bbe2767c49c645037f5/src/bloom/filter.jl#L97-L102">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.empty!-Tuple{BloomFilter}" href="#Base.empty!-Tuple{BloomFilter}"><code>Base.empty!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">empty!(filter::BloomFilter)</code></pre><p>Remove all elements from BloomFilter, resetting it to initial state.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/d9437535b5e2046d01411bbe2767c49c645037f5/src/bloom/filter.jl#L105-L109">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Probably.constrain-Tuple{Type{BloomFilter}}" href="#Probably.constrain-Tuple{Type{BloomFilter}}"><code>Probably.constrain</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">constrain(Type{BloomFilter}; fpr=nothing, mem=nothing, capacity=nothing)</code></pre><p>Given BloomFilter and two of three keyword arguments, as constrains, optimize the elided keyword argument. Returns a NamedTuple with (m, k, fpr, memory, capacity), which applies to the optimized Bloom filter.</p><p><strong>Examples</strong></p><pre><code class="language-none">julia&gt; # Bloom filter with FPR ≤ 0.05, and memory usage ≤ 50_000_000 bytes

julia&gt; c = constrain(BloomFilter, fpr=0.05, memory=50_000_000)
(m = 399999808, k = 4, fpr = 0.049999979847949585, memory = 50000000, capacity = 6403092
1)

julia&gt; x = BloomFilter(c.m, c.k); # capacity optimized</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jakobnissen/Probably.jl/blob/d9437535b5e2046d01411bbe2767c49c645037f5/src/bloom/filter.jl#L175-L193">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cuckoo/">« Cuckoo filter</a><a class="docs-footer-nextpage" href="../cuckoo_v_bloom/">Cuckoo versus bloom filters »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 17 May 2024 09:30">Friday 17 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
